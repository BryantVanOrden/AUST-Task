{"timestamp":"2025-09-17T06:12:29.474862","level":"info","event":"DAG bundles loaded: dags-folder, example_dags","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-09-17T06:12:29.475184","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/moodle_ldap_sync_and_transform_generic.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-09-17T06:12:29.692174Z","level":"info","event":"Task instance is in running state","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.692431Z","level":"info","event":" Previous state of the Task instance: TaskInstanceState.QUEUED","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.693061Z","level":"info","event":"Current task name:transform_moodle_data","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.693233Z","level":"info","event":"Dag name:moodle_ldap_dynamic_etl_v2","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.693439Z","level":"info","event":"--- Starting Moodle Data Transformation ---","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.694395","level":"warning","event":"/home/airflow/.local/lib/python3.12/site-packages/airflow/models/connection.py:471: DeprecationWarning: Using Connection.get_connection_from_secrets from `airflow.models` is deprecated.Please use `get` on Connection from sdk(`airflow.sdk.Connection`) instead\n  warnings.warn(\n","logger":"py.warnings"}
{"timestamp":"2025-09-17T06:12:29.700124","level":"info","event":"Connection Retrieved 'mysql_default'","logger":"airflow.hooks.base"}
{"timestamp":"2025-09-17T06:12:29.724603","level":"info","event":"Running statement: DROP TABLE IF EXISTS AUST.moodle_users_cleaned;, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.735780","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.739324","level":"info","event":"Running statement: CREATE TABLE AUST.moodle_users_cleaned (`id` BIGINT, `auth` TEXT, `lang` TEXT, `email` TEXT, `theme` TEXT, `fullname` TEXT, `lastname` TEXT, `timezone` TEXT, `username` TEXT, `confirmed` BOOLEAN, `firstname` TEXT, `suspended` BOOLEAN, `department` TEXT, `lastaccess` BIGINT, `mailformat` BIGINT, `description` TEXT, `firstaccess` BIGINT, `trackforums` BIGINT, `profileimageurl` TEXT, `descriptionformat` FLOAT, `profileimageurlsmall` TEXT, `country` TEXT, `preferences` TEXT, PRIMARY KEY (`id`));, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.755047","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.768057Z","level":"info","event":"Loaded 13 records into AUST.moodle_users_cleaned.","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.774101","level":"info","event":"Running statement: DROP TABLE IF EXISTS AUST.moodle_courses_cleaned;, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.785054","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.788797","level":"info","event":"Running statement: CREATE TABLE AUST.moodle_courses_cleaned (`id` BIGINT, `lang` TEXT, `format` TEXT, `enddate` BIGINT, `summary` TEXT, `visible` BIGINT, `fullname` TEXT, `idnumber` TEXT, `maxbytes` BIGINT, `groupmode` BIGINT, `newsitems` BIGINT, `shortname` TEXT, `startdate` BIGINT, `categoryid` BIGINT, `forcetheme` TEXT, `showgrades` BIGINT, `displayname` TEXT, `numsections` BIGINT, `showreports` BIGINT, `timecreated` BIGINT, `timemodified` BIGINT, `summaryformat` BIGINT, `groupmodeforce` BIGINT, `completionnotify` BIGINT, `enablecompletion` BIGINT, `categorysortorder` BIGINT, `defaultgroupingid` BIGINT, `showactivitydates` BOOLEAN, `courseformatoptions` TEXT, `showcompletionconditions` TEXT, `hiddensections` FLOAT, PRIMARY KEY (`id`));, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.806542","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.819343Z","level":"info","event":"Loaded 4 records into AUST.moodle_courses_cleaned.","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.825995","level":"info","event":"Running statement: DROP TABLE IF EXISTS AUST.moodle_assignments_cleaned;, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.837205","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.840881","level":"info","event":"Running statement: CREATE TABLE AUST.moodle_assignments_cleaned (`id` BIGINT, `cmid` BIGINT, `name` TEXT, `grade` BIGINT, `intro` TEXT, `course` BIGINT, `configs` TEXT, `duedate` BIGINT, `timelimit` BIGINT, `cutoffdate` BIGINT, `hidegrader` BIGINT, `introfiles` TEXT, `introformat` BIGINT, `maxattempts` BIGINT, `blindmarking` BIGINT, `gradepenalty` BIGINT, `timemodified` BIGINT, `nosubmissions` BIGINT, `gradingduedate` BIGINT, `teamsubmission` BIGINT, `markingworkflow` BIGINT, `completionsubmit` BIGINT, `introattachments` TEXT, `markinganonymous` BIGINT, `revealidentities` BIGINT, `submissiondrafts` BIGINT, `markingallocation` BIGINT, `sendnotifications` BIGINT, `attemptreopenmethod` TEXT, `sendlatenotifications` BIGINT, `submissionattachments` BIGINT, `allowsubmissionsfromdate` BIGINT, `sendstudentnotifications` BIGINT, `teamsubmissiongroupingid` BIGINT, `requiresubmissionstatement` BIGINT, `preventsubmissionnotingroup` BIGINT, `requireallteammemberssubmit` BIGINT, PRIMARY KEY (`id`));, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.857614","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.872655Z","level":"info","event":"Loaded 1 records into AUST.moodle_assignments_cleaned.","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.878762","level":"info","event":"Running statement: DROP TABLE IF EXISTS AUST.moodle_submissions_cleaned;, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.888861","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.892650","level":"info","event":"Running statement: CREATE TABLE AUST.moodle_submissions_cleaned (`id` BIGINT, `status` TEXT, `userid` BIGINT, `groupid` BIGINT, `plugins` TEXT, `timecreated` BIGINT, `timestarted` TEXT, `assignmentid` BIGINT, `timemodified` BIGINT, `attemptnumber` BIGINT, `gradingstatus` TEXT, PRIMARY KEY (`id`));, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.908210","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.917200Z","level":"info","event":"Loaded 7 records into AUST.moodle_submissions_cleaned.","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.926527","level":"info","event":"Running statement: DROP TABLE IF EXISTS AUST.moodle_assign_grades_cleaned;, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.936713","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.940190","level":"info","event":"Running statement: CREATE TABLE AUST.moodle_assign_grades_cleaned (`id` BIGINT, `grade` TEXT, `grader` BIGINT, `userid` BIGINT, `timecreated` BIGINT, `assignmentid` BIGINT, `timemodified` BIGINT, `attemptnumber` BIGINT, PRIMARY KEY (`id`));, parameters: None","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.955506","level":"info","event":"Rows affected: 0","logger":"airflow.task.hooks.airflow.providers.mysql.hooks.mysql.MySqlHook"}
{"timestamp":"2025-09-17T06:12:29.963183","level":"error","event":"Task failed with exception","logger":"task","error_detail":[{"exc_type":"IntegrityError","exc_value":"(MySQLdb.IntegrityError) (1062, \"Duplicate entry '1' for key 'moodle_assign_grades_cleaned.PRIMARY'\")\n[SQL: INSERT INTO `AUST`.moodle_assign_grades_cleaned (id, grade, grader, userid, timecreated, assignmentid, timemodified, attemptnumber) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)]\n[parameters: ((1, '100.00000', 2, 6, 1758086269, 1, 1758086285, 0), (2, '100.00000', 2, 8, 1758086285, 1, 1758086295, 0), (3, '0.00000', 2, 9, 1758086296, 1, 1758086300, 0), (4, '0.00000', 2, 11, 1758086301, 1, 1758086303, 0), (5, '0.00000', 2, 12, 1758086304, 1, 1758086306, 0), (6, '0.00000', 2, 15, 1758086307, 1, 1758086309, 0), (1, '100.00000', 2, 6, 1758086269, 1, 1758086285, 0), (2, '100.00000', 2, 8, 1758086285, 1, 1758086295, 0)  ... displaying 10 of 24 total bound parameter sets ...  (5, '0.00000', 2, 12, 1758086304, 1, 1758086306, 0), (6, '0.00000', 2, 15, 1758086307, 1, 1758086309, 0))]\n(Background on this error at: https://sqlalche.me/e/14/gkpj)","exc_notes":[],"syntax_error":null,"is_cause":false,"frames":[{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":920,"name":"run"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":1215,"name":"_execute_task"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/bases/operator.py","lineno":397,"name":"wrapper"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/bases/decorator.py","lineno":251,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/bases/operator.py","lineno":397,"name":"wrapper"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":216,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":239,"name":"execute_callable"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/callback_runner.py","lineno":81,"name":"run"},{"filename":"/opt/airflow/dags/moodle_ldap_sync_and_transform_generic.py","lineno":325,"name":"transform_moodle_data"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py","lineno":333,"name":"wrapper"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py","lineno":3008,"name":"to_sql"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":788,"name":"to_sql"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":1958,"name":"to_sql"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":1507,"name":"insert_records"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":1498,"name":"insert_records"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":1059,"name":"insert"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py","lineno":951,"name":"_execute_insert"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":1385,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py","lineno":334,"name":"_execute_on_connection"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":1577,"name":"_execute_clauseelement"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":1953,"name":"_execute_context"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":2134,"name":"_handle_dbapi_exception"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py","lineno":211,"name":"raise_"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":1890,"name":"_execute_context"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/mysql/mysqldb.py","lineno":183,"name":"do_executemany"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":241,"name":"executemany"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":275,"name":"_do_execute_many"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":179,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":330,"name":"_query"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/connections.py","lineno":280,"name":"query"}],"is_group":false,"exceptions":[]},{"exc_type":"IntegrityError","exc_value":"(1062, \"Duplicate entry '1' for key 'moodle_assign_grades_cleaned.PRIMARY'\")","exc_notes":[],"syntax_error":null,"is_cause":true,"frames":[{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py","lineno":1890,"name":"_execute_context"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/mysql/mysqldb.py","lineno":183,"name":"do_executemany"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":241,"name":"executemany"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":275,"name":"_do_execute_many"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":179,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/cursors.py","lineno":330,"name":"_query"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/MySQLdb/connections.py","lineno":280,"name":"query"}],"is_group":false,"exceptions":[]}]}
{"timestamp":"2025-09-17T06:12:29.964501Z","level":"info","event":"Task instance in failure state","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.964722Z","level":"info","event":"Task start","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.964902Z","level":"info","event":"Task:<Task(_PythonDecoratedOperator): transform_moodle_data>","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.965105Z","level":"info","event":"Failure caused by (MySQLdb.IntegrityError) (1062, \"Duplicate entry '1' for key 'moodle_assign_grades_cleaned.PRIMARY'\")","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.965297Z","level":"info","event":"[SQL: INSERT INTO `AUST`.moodle_assign_grades_cleaned (id, grade, grader, userid, timecreated, assignmentid, timemodified, attemptnumber) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.965485Z","level":"info","event":"[parameters: ((1, '100.00000', 2, 6, 1758086269, 1, 1758086285, 0), (2, '100.00000', 2, 8, 1758086285, 1, 1758086295, 0), (3, '0.00000', 2, 9, 1758086296, 1, 1758086300, 0), (4, '0.00000', 2, 11, 1758086301, 1, 1758086303, 0), (5, '0.00000', 2, 12, 1758086304, 1, 1758086306, 0), (6, '0.00000', 2, 15, 1758086307, 1, 1758086309, 0), (1, '100.00000', 2, 6, 1758086269, 1, 1758086285, 0), (2, '100.00000', 2, 8, 1758086285, 1, 1758086295, 0)  ... displaying 10 of 24 total bound parameter sets ...  (5, '0.00000', 2, 12, 1758086304, 1, 1758086306, 0), (6, '0.00000', 2, 15, 1758086307, 1, 1758086309, 0))]","chan":"stdout","logger":"task"}
{"timestamp":"2025-09-17T06:12:29.965653Z","level":"info","event":"(Background on this error at: https://sqlalche.me/e/14/gkpj)","chan":"stdout","logger":"task"}
